window.addEventListener("DOMContentLoaded",p=>{const u=document.body.querySelector("#sidebarToggle");u&&u.addEventListener("click",f=>{f.preventDefault(),document.body.classList.toggle("sb-sidenav-toggled"),localStorage.setItem("sb|sidebar-toggle",document.body.classList.contains("sb-sidenav-toggled"))})});setTimeout(function(){$(".preload").css("display","none"),$(".content-body").css("display","none")},1200);$(document).ready(function(){$(function(){$(".poshtaPopover").popover({placement:"right",trigger:"click"}),$(".tooltipPromo").tooltip({placement:"right",trigger:"hover"})});var p=new bootstrap.Toast($(".toast"),[]);$("#typeTable").val($("#typeTable").attr("data-selected")),$(".actions .fa-trash").click(function(){let t=$(this).closest("tr").children(":first").text(),e=$(this).closest("tr"),i=$(this).attr("data-url");$.confirm({title:"Підтвердження",content:"Ви впевнені що хочете видалити цей запис?",buttons:{confirm:{text:"Так",btnClass:"btn-dark",action:function(){$.ajax({type:"POST",url:i,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:t},success:function(a){a!=="1"?($(".toast-body").text(a),p.show()):$(e).remove()}})}},cancel:{text:"Закрити",btnClass:"btn-dark",action:function(){}}}})}),$(".btn-order-products").click(function(t){$(".modal-body").html(`<div class='d-flex justify-content-center w-100'><div class="spinner-border p-5" role="status">
  <span class="visually-hidden">Loading...</span>
</div></div>`);let e=$(this).attr("data-url"),i=$(this).closest("tr"),a=$(i).children().first().text();$.ajax({type:"POST",url:e,data:{_token:$('meta[name="csrf-token"]').attr("content"),id_order:a},success:function(n){$(".modal-body").html(n),$(".modal-body").attr("data-order",a)}})}),$("#addProductsBtnToOrder").click(function(t){let e=$(this).attr("data-url"),i=$(".modal-body").attr("data-order"),a=$("#idProductOrderAdd").val(),n=$("#countProductOrder").val();$.ajax({type:"POST",url:e,data:{_token:$('meta[name="csrf-token"]').attr("content"),id_order:i,id_product:a,count:n},success:function(l){let s="",r=$(".modal-body").attr("data-product-url");for(let d of l)$("#p-"+d.id).length&&$("#p-"+d.id).remove(),s+="<div id='p-"+d.id+"' style='height: 120px; background: cornsilk!important;' class='card d-block mb-3'><img class='float-start d-block me-2' width='150px' height='120px' src='"+d.image+"'><div class='d-block'><a href='"+r+"/"+d.id+"' class='mt-1 fw-bold text-decoration-none text-dark d-block'>"+d.name+" "+d.count_substance+"</a>---<span class='d-block fw-bold'><span class='text-warning'>Кількість:</span> "+d.count+" шт</span><span class='d-block fw-bold'><span class='text-warning'>Ціна:</span> "+d.price+" грн</span></div></div>";$(".modal-body").prepend(s),$("#idProductOrderAdd").val(""),$("#countProductOrder").val("")}})}),$("#edit-order-btn").click(function(t){$("#edit-order-block").css("display","block")}),$("#closeEditBlock").click(function(t){$("#edit-order-block").css("display","none"),$("#idProductOrderAdd").val(""),$("#countProductOrder").val(""),$("#idProductOrderDelete").val("")}),$("tbody td").click(function(t){t.target!=document.querySelector("#edit-input")&&$("#edit-form").css("display")=="none"&&JSON.parse($("table").attr("data-edited-column")).includes($(this).index())&&($("#old-text").text($.trim($(this).text())),$(this).html($("#edit-form")),$("#edit-input").val($.trim($(this).text())),$("#edit-form").css("display","flex"),$("#edit-input").focus())}),$("#edit-input").on("keypress",function(t){if(t.keyCode===13){let e=$("#old-text").text(),i=$("#edit-input").val(),a=$(this).closest("td");if($(".edit-block").html($("#edit-form")),e===i)$(a).text(e),$("#edit-form").css("display","none");else{let n=$("#edit-input").attr("data-url"),l=$(a).closest("tr").children(":first").text(),s=$(a).index(),r=i,d=$("#typeTable").attr("data-selected");$("#edit-form").css("display","none"),$(a).html(`<div class='w-100 text-center'><div class="spinner-grow text-dark" role="status"><span class="visually-hidden">Loading...</span></div></div>`),$.ajax({type:"POST",url:n,async:!1,data:{_token:$('meta[name="csrf-token"]').attr("content"),table:d,id:l,column:s,value:r},success:function(c){a.html(c)},error:function(c){$(".toast-body").text("Введені невірні дані при редагуванні!"),p.show(),$(a).html(e)}})}}}),$(".category-active").on("change",function(){let t=$(this).attr("data-url"),e=$(this).closest("tr").children(":first").text(),i=$(this).val();$.ajax({type:"POST",url:t,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:e,value:i},success:function(a){}})}),$(".product-active").on("change",function(){let t=$(this).attr("data-url"),e=$(this).closest("tr").children(":first").text(),i=$(this).val();$.ajax({type:"POST",url:t,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:e,value:i},success:function(a){}})}),$(".product-category").on("change",function(){let t=$(this).attr("data-url"),e=$(this).closest("tr").children(":first").text(),i=$(this).val();$.ajax({type:"POST",url:t,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:e,value:i},success:function(a){}})}),$(".user-role").on("change",function(){let t=$(this).attr("data-url"),e=$(this).closest("tr").children(":first").text(),i=$(this).val();$.ajax({type:"POST",url:t,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:e,value:i},success:function(a){}})}),$(".btn-icon").click(function(){let t=$(this).attr("data-src"),e=$(this).closest("tr").children(":first").text();$("#icon-img").attr("src",t),$("#icon-img").attr("data-id",e)}),$("#load-image").on("change",function(){let t=new FormData,e=$("#icon-img").attr("data-id"),i=$("#icon-img").attr("src"),a=$("#load-image").prop("files")[0],n=$(this).attr("data-url");t.append("_token",$('meta[name="csrf-token"]').attr("content")),t.append("category_image",a),t.append("id",e),$(".loader-img").html(`<div class='d-flex justify-content-center'><div style='height: 100px; width: 100px;' class="spinner-border" role="status">
  <span class="visually-hidden">Loading...</span>
</div></div>`),$.ajax({type:"POST",enctype:"multipart/form-data",url:n,processData:!1,contentType:!1,data:t,success:function(l){$(".loader-img").html("<img data-id='"+e+`' src="`+l+'" alt="Icon" id="icon-img" class="mb-3">'),$("#load-image").val(""),$("[data-src='"+i+"']").attr("data-src",l)}})}),$(".btn-edit-description").click(function(){let t=$(this).attr("data-content"),e=$(this).closest("tr").children(":first").text();$(".trix-editor-description").html(t),$("#id-product-hidden").val(e)}),$(".btn-edit-keywords").click(function(){let t=$(this).attr("data-content"),e=$(this).closest("tr").children(":first").text();$("#textarea-keywords").val(t),$("#id-product-keywords-hidden").val(e)}),$(".btn-product-images").click(function(){let t=$(this).attr("data-images"),e=$(this).attr("data-click");$("#productModal").attr("data-entity",e);let i=$(this).closest("tr").children(":first").text();t=JSON.parse(t);let a=f(i,t);u(a)}),$(".tool-arrow").click(function(){let t=$("#productModal").attr("data-entity"),e=h(),i=m(),a=$(this).attr("data-url"),n=$(this).attr("data-direction"),l=null,s=null,r=null;for(let d=0;d<e.length;d++)if(e[d].image===i){let c=e[d];r=c.id,l=c.father_id==0?null:e.find(o=>o.id==c.father_id).id,s=d<e.length-1?e.find(o=>o.father_id==r).id:null,$(".photos").html(`<div class='d-flex justify-content-center w-100 pt-5 pb-5'><div class="spinner-border p-5" role="status">
  <span class="visually-hidden">Loading...</span>
</div></div>`),$.ajax({type:"POST",url:a,async:!1,data:{_token:$('meta[name="csrf-token"]').attr("content"),this_id:r,child_id:s,father_id:l,direction:n,product_id:t},success:function(o){let g=JSON.stringify(o.images);$('[data-click="'+o.id+'"]').attr("data-images",g);let v=f(o.id,o.images);u(v)}})}}),$("#load-files").on("change",function(){let t=$("#tool-add").attr("data-url"),e=$("#productModal").attr("data-entity"),i=new FormData,a=$("#load-files").prop("files");if(a.length){i.append("_token",$('meta[name="csrf-token"]').attr("content")),i.append("product_id",e);for(let n of a)i.append("product_images[]",n);$(".photos").html(`<div class='d-flex justify-content-center w-100 pt-5 pb-5'><div class="spinner-border p-5" role="status">
  <span class="visually-hidden">Loading...</span>
</div></div>`),$.ajax({type:"POST",enctype:"multipart/form-data",url:t,processData:!1,contentType:!1,data:i,success:function(n){let l=JSON.stringify(n.images);$('[data-click="'+n.id+'"]').attr("data-images",l);let s=f(n.id,n.images);u(s)}})}}),$("#tool-remove").click(function(){let t=$(this).attr("data-url"),e=$("#productModal").attr("data-entity"),i=m(),a=h();for(let n=0;n<a.length;n++)if(a[n].image===i){let l=a[n].id,s=a[n].father_id!==0?a.find(d=>d.id==a[n].father_id).id:null,r=n<a.length-1?a.find(d=>d.father_id==l).id:null;$(".photos").html(`<div class='d-flex justify-content-center w-100 pt-5 pb-5'><div class="spinner-border p-5" role="status">
  <span class="visually-hidden">Loading...</span>
</div></div>`),$.ajax({type:"POST",url:t,data:{_token:$('meta[name="csrf-token"]').attr("content"),this_id:l,right_id:r,left_id:s,product_id:e},success:function(d){let c=JSON.stringify(d.images);$('[data-click="'+d.id+'"]').attr("data-images",c);let o=f(d.id,d.images);u(o)}})}}),$(".btn-add-promo").click(function(){let t=$("#promocode").val(),e=$("#discount").val(),i=$("#endDate").val(),a=$(this).attr("data-url");$.ajax({type:"POST",url:a,data:{_token:$('meta[name="csrf-token"]').attr("content"),promocode:t,discount:e,end_date:i},success:function(n){location.reload(!0)}})}),$(".promos .fa-trash").click(function(){let t=$(this).closest("tr").children(":first").text(),e=$(this).closest("tr"),i=$(this).attr("data-url");$.confirm({title:"Підтвердження",content:"Ви впевнені що хочете видалити цей запис?",buttons:{confirm:{text:"Так",btnClass:"btn-dark",action:function(){$.ajax({type:"POST",url:i,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:t},success:function(a){$(e).remove()}})}},cancel:{text:"Закрити",btnClass:"btn-dark",action:function(){}}}})}),$(".btn-pay").click(function(t){let e=$(this).attr("data-url"),i=$(this).closest("tr"),a=$(i).children().first().text();$.ajax({type:"POST",url:e,data:{_token:$('meta[name="csrf-token"]').attr("content"),id_partner:a},success:function(n){location.reload()}})}),$(".btn-edit-category-keywords").click(function(){let t=$(this).attr("data-content"),e=$(this).closest("tr").children(":first").text();$("#textarea-keywords").val(t),$("#id-category-keywords-hidden").val(e)});function u(t){$(".photos").html('<div id="fotorama" data-auto="false" class="fotorama bg-light" data-width="100%" data-ratio="800/600" data-allowfullscreen="true"  data-loop="true"></div>'),$(".fotorama").fotorama({data:t})}function f(t,e){let i=$(".photos").attr("data-full-path"),a=[];for(let n=0;n<e.length;n++)a.push({img:i+"/products/"+t+"/"+e[n].image,id:t});return a}function m(){let t=$(".fotorama__active img").attr("src");if(t)return t.substring(t.lastIndexOf("/")+1)}function h(){let t=$("#productModal").attr("data-entity"),e=$("[data-click='"+t+"']").attr("data-images");return JSON.parse(e)}});
